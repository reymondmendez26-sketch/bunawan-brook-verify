<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/1NTDDp-Ow6-HTgChNrH85WpWpw80EMEA-ZpjpgYe674k/export?format=csv";

function getQueryParam(name) {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(name);
}

function verify(memberIdFromQR = null) {
  const input = document.getElementById("memberId");
  const output = document.getElementById("output");

  const id = memberIdFromQR || input.value.trim();

  if (!id) {
    output.innerHTML = "<div class='result EXPELLED'>PLEASE ENTER MEMBER ID</div>";
    return;
  }

  fetch(SHEET_URL)
    .then(res => res.text())
    .then(text => {
      const rows = text.replace(/\r/g, "").split("\n").slice(1);
      let found = false;

      rows.forEach(row => {
        const cols = row.split(",");

        if (cols[0] && cols[0].trim() === id) {
          found = true;

          output.innerHTML = `
            <div class="result ${cols[5]}">
              <strong>Status:</strong> ${cols[5]}<br><br>
              <b>Full Name:</b> ${cols[1]}<br>
              <b>Alexis / Medusa Name:</b> ${cols[2]}<br>
              <b>GT:</b> ${cols[3]}<br>
              <b>Date Survive:</b> ${cols[4]}<br>
              <b>Position:</b> ${cols[7]}<br>
              <b>Remarks:</b> ${cols[6]}
            </div>
          `;
        }
      });

      if (!found) {
        output.innerHTML = "<div class='result EXPELLED'>MEMBER NOT FOUND</div>";
      }
    })
    .catch(() => {
      output.innerHTML = "<div class='result EXPELLED'>ERROR LOADING DATA</div>";
    });
}

// AUTO VERIFY IF FROM QR
window.onload = () => {
  const qrId = getQueryParam("id");
  if (qrId) {
    document.getElementById("memberId").value = qrId;
    verify(qrId);
  }
};
</script>
